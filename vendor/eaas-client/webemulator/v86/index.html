<!doctype html><meta charset="utf-8" /><script src="../webemulator.js"></script>
<div id="screen">
<div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
<canvas style="display: none"></canvas>
</div>
<script src="third_party/v86/build/v86_all.js"></script>
<script>
new class V86 extends WebEmulator {
  constructor() {
    super();

    const v86 = "third_party/v86";
    this.config = {
      screen_container: document.getElementById("screen"),
      bios: {
          // Use Bochs BIOS as SeaBIOS seems to be broken when using
          // multiple devices (hard/floppy/CD-ROM drives);
          // cf. <https://github.com/copy/v86/issues/55>,
          // <https://bugzilla.redhat.com/show_bug.cgi?id=997817>.
          url: `${v86}/bios/bochs-bios.bin`,
      },
      vga_bios: {
          url: `${v86}/bios/bochs-vgabios.bin`,
      },
      autostart: true,
      // boot_order: 0xXYZ (X, Y, Z are hex digits):
      // Try Z first, then Y, finally X.
      // X/Y/Z can be: 1 (floppy), 2 (hard disk),
      // 3 (CD-ROM), 4 (disabled).
      // Cf. <https://github.com/qemu/seabios/blob/master/src/boot.c#L267>,
      // <http://bochs.sourceforge.net/cgi-bin/lxr/source/bios/rombios.c#L8257>.
      boot_order: 0x312,
      fastboot: true,
    };
  }

  start() {
    this.emulator = new V86Starter(this.config);
  }

  connectDrive(drive, file, connect) {
    console.log("adding drive", drive, file);
    switch (drive.type) {
      case "DISK":
        this.config.hda = {buffer: file, /*url: "."*/}
      break;
      case "CDROM":
        this.config.cdrom = {buffer: file};
      break;
    }
  }
}
</script>
